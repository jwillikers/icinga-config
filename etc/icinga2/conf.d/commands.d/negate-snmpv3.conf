// -*- mode: icinga -*-
object CheckCommand "negate-snmpv3" {
    import "ipv4-or-ipv6"

    command = [ PluginDir + "/negate" ]

	arguments = {
		"-t" = {
			value = "$negate_timeout$"
			description = "Seconds before plugin times out (default: 11)"
		}
		"-T" = {
			value = "$negate_timeout_result$"
			description = "Custom result on Negate timeouts"
		}
		"-o" = {
			value = "$negate_ok$"
		}
		"-w" = {
			value = "$negate_warning$"
		}
		"-c" = {
			value = "$negate_critical$"
		}
		"-u" = {
			value = "$negate_unknown$"
		}
		"-s" = {
			set_if = "$negate_substitute$"
			description = "Substitute output text as well. Will only substitute text in CAPITALS"
		}
		"--wrapped-plugin" = {
			value = {{
				var command = "/usr/lib/nagios/plugins/check_snmp"
                var arguments = {
                    "-H" = {
                        value = "$snmpv3_address$"
                        description = "Host name, IP Address, or unix socket (must be an absolute path)"
                    }
                    "-p" = {
                        value = "$snmpv3_port$"
                        description = "Port number"
                    }
                    "-n" = {
                        set_if = "$snmpv3_getnext$"
                        description = "Use SNMP GETNEXT instead of SNMP GET"
                    }
                    "-P" = {
                        value = 3
                        description = "SNMP protocol version"
                    }
                    "-L" = {
                        value = "$snmpv3_seclevel$"
                        description = "SNMPv3 securityLevel"
                    }
                    "-a" = {
                        value = "$snmpv3_auth_alg$"
                        description = "SNMPv3 auth proto"
                    }
                    "-U" = {
                        value = "$snmpv3_user$"
                        description = "SNMPv3 username"
                    }
                    "-N" = {
                        value = "$snmpv3_context$"
                        description = "SNMPv3 context"
                    }
                    "-A" = {
                        value = "$snmpv3_auth_key$"
                        description = "SNMPv3 authentication password"
                    }
                    "-X" = {
                        value = "$snmpv3_priv_key$"
                        description = "SNMPv3 privacy password"
                    }
                    "-o" = {
                        value = "$snmpv3_oid$"
                        description = "Object identifier(s) or SNMP variables whose value you wish to query"
                    }
                    "-x" = {
                        value = "$snmpv3_priv_alg$"
                        description = "SNMPv3 priv proto (default DES)"
                    }
                    "-w" = {
                        value = "$snmpv3_warn$"
                        description = "Warning threshold range(s)"
                    }
                    "-c" = {
                        value = "$snmpv3_crit$"
                        description = "Critical threshold range(s)"
                    }
                    "-s" = {
                        value = "$snmpv3_string$"
                        description = "Return OK state (for that OID) if STRING is an exact match"
                    }
                    "-r" = {
                        value = "$snmpv3_ereg$"
                        description = "Return OK state (for that OID) if extended regular expression REGEX matches"
                    }
                    "-R" = {
                        value = "$snmpv3_eregi$"
                        description = "Return OK state (for that OID) if case-insensitive extended REGEX matches"
                    }
                    "--invert-search" = {
                        set_if = "$snmpv3_invert_search$"
                        description = "Invert search result and return CRITICAL if found"
                    }
                    "-l" = {
                        value = "$snmpv3_label$"
                        description = "Prefix label for output from plugin"
                    }
                    "-m" = {
                        value = "$snmpv3_miblist$"
                        description = "List of SNMP MIBs for translating OIDs between numeric and textual representation"
                    }
                    "-u" = {
                        value = "$snmpv3_units$"
                        description = "Units label(s) for output data (e.g., 'sec.')"
                    }
                    "--rate-multiplier" = {
                        value = "$snmpv3_rate_multiplier$"
                        description = "Converts rate per second. For example, set to 60 to convert to per minute"
                    }
                    "--rate" = {
                        set_if = "$snmpv3_rate$"
                        description = "Enable rate calculation"
                    }
                    "-t" = {
                        value = "$snmpv3_timeout$"
                        description = "Seconds before connection times out (default: 10)"
                    }
                }

				if (typeof(command) == String && !arguments) {
					return command
				}

				var escaped_args = [command]
				for (arg in arguments) {
					escaped_args.add(arg)
				}
				return escaped_args.join(" ")
			}}
			skip_key = true
			order = 1
		}
	}

	vars.negate_timeout_result = "UNKNOWN"
    vars.snmpv3_address = "$check_address$"
    vars.snmpv3_auth_alg = "SHA"
    vars.snmpv3_priv_alg = "AES"
    vars.snmpv3_seclevel = "authPriv"
    vars.snmpv3_timeout = "10"
}